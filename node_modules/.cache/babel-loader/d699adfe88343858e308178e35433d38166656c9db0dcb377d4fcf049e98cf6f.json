{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{BrowserRouter as Router,Routes,Route,Navigate}from\"react-router-dom\";import{supabase}from\"./supabaseClient\";import Layout from\"./Layout\";import Dashboard from\"./pages/Dashboard\";import Proiecte from\"./pages/Proiecte\";import Taskuri from\"./pages/Taskuri\";import Setari from\"./pages/Setari\";import Login from\"./Login\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function App(){const[session,setSession]=useState(undefined);// undefined = încă se încarcă\nconst[userRole,setUserRole]=useState(\"user\");// Obținem sesiunea activă și ascultăm modificările\nuseEffect(()=>{async function loadSession(){const{data}=await supabase.auth.getSession();setSession(data.session);const{data:listener}=supabase.auth.onAuthStateChange((_event,session)=>{setSession(session);});return()=>listener.subscription.unsubscribe();}loadSession();},[]);// După ce avem sesiunea, citim rolul din tabelul `users`\nuseEffect(()=>{async function fetchRole(){if(session!==null&&session!==void 0&&session.user){const{data,error}=await supabase.from(\"users\").select(\"role\").eq(\"id\",session.user.id).single();if(!error&&data){setUserRole(data.role);}else{setUserRole(\"user\");}}}fetchRole();},[session]);// Afișează un mesaj temporar cât se încarcă sesiunea\nif(session===undefined){return/*#__PURE__*/_jsx(\"p\",{style:{padding:20},children:\"Se ini\\u021Bializeaz\\u0103 sesiunea...\"});}// Dacă nu există sesiune activă → pagina de login\nif(!session){return/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsx(Routes,{children:/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(Login,{})})})});}// Dacă există sesiune activă → aplicația completă\nreturn/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(Dashboard,{})}),/*#__PURE__*/_jsx(Route,{path:\"/proiecte\",element:/*#__PURE__*/_jsx(Proiecte,{})}),/*#__PURE__*/_jsx(Route,{path:\"/taskuri\",element:/*#__PURE__*/_jsx(Taskuri,{})}),(userRole===\"admin\"||userRole===\"sef\")&&/*#__PURE__*/_jsx(Route,{path:\"/setari\",element:/*#__PURE__*/_jsx(Setari,{})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(Navigate,{to:\"/\"})})]})})});}export default App;","map":{"version":3,"names":["React","useEffect","useState","BrowserRouter","Router","Routes","Route","Navigate","supabase","Layout","Dashboard","Proiecte","Taskuri","Setari","Login","jsx","_jsx","jsxs","_jsxs","App","session","setSession","undefined","userRole","setUserRole","loadSession","data","auth","getSession","listener","onAuthStateChange","_event","subscription","unsubscribe","fetchRole","user","error","from","select","eq","id","single","role","style","padding","children","path","element","to"],"sources":["C:/Users/gheor/Desktop/flavi-proiectare-layout/src/App.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { BrowserRouter as Router, Routes, Route, Navigate } from \"react-router-dom\";\r\nimport { supabase } from \"./supabaseClient\";\r\n\r\nimport Layout from \"./Layout\";\r\nimport Dashboard from \"./pages/Dashboard\";\r\nimport Proiecte from \"./pages/Proiecte\";\r\nimport Taskuri from \"./pages/Taskuri\";\r\nimport Setari from \"./pages/Setari\";\r\nimport Login from \"./Login\";\r\n\r\nfunction App() {\r\n  const [session, setSession] = useState(undefined); // undefined = încă se încarcă\r\n  const [userRole, setUserRole] = useState(\"user\");\r\n\r\n  // Obținem sesiunea activă și ascultăm modificările\r\n  useEffect(() => {\r\n    async function loadSession() {\r\n      const { data } = await supabase.auth.getSession();\r\n      setSession(data.session);\r\n\r\n      const { data: listener } = supabase.auth.onAuthStateChange((_event, session) => {\r\n        setSession(session);\r\n      });\r\n\r\n      return () => listener.subscription.unsubscribe();\r\n    }\r\n\r\n    loadSession();\r\n  }, []);\r\n\r\n  // După ce avem sesiunea, citim rolul din tabelul `users`\r\n  useEffect(() => {\r\n    async function fetchRole() {\r\n      if (session?.user) {\r\n        const { data, error } = await supabase\r\n          .from(\"users\")\r\n          .select(\"role\")\r\n          .eq(\"id\", session.user.id)\r\n          .single();\r\n\r\n        if (!error && data) {\r\n          setUserRole(data.role);\r\n        } else {\r\n          setUserRole(\"user\");\r\n        }\r\n      }\r\n    }\r\n\r\n    fetchRole();\r\n  }, [session]);\r\n\r\n  // Afișează un mesaj temporar cât se încarcă sesiunea\r\n  if (session === undefined) {\r\n    return <p style={{ padding: 20 }}>Se inițializează sesiunea...</p>;\r\n  }\r\n\r\n  // Dacă nu există sesiune activă → pagina de login\r\n  if (!session) {\r\n    return (\r\n      <Router>\r\n        <Routes>\r\n          <Route path=\"*\" element={<Login />} />\r\n        </Routes>\r\n      </Router>\r\n    );\r\n  }\r\n\r\n  // Dacă există sesiune activă → aplicația completă\r\n  return (\r\n    <Router>\r\n      <Layout>\r\n        <Routes>\r\n          <Route path=\"/\" element={<Dashboard />} />\r\n          <Route path=\"/proiecte\" element={<Proiecte />} />\r\n          <Route path=\"/taskuri\" element={<Taskuri />} />\r\n\r\n          {/* doar adminii și șefii pot accesa setările */}\r\n          {(userRole === \"admin\" || userRole === \"sef\") && (\r\n            <Route path=\"/setari\" element={<Setari />} />\r\n          )}\r\n\r\n          {/* orice altă rută → redirecționare la Dashboard */}\r\n          <Route path=\"*\" element={<Navigate to=\"/\" />} />\r\n        </Routes>\r\n      </Layout>\r\n    </Router>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}